<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOD</title>
</head>
<body>
    <h1>Base64 JSON Processor</h1>
    <form id="jsonForm" onsubmit="processJson(event)">
        <label for="json_content">Enter JSON formatted text:</label><br>
        <textarea id="json_content" name="json_content" rows="10" cols="50"></textarea><br>
        <input type="submit" value="Submit">
    </form>
    <div id="result">
        <h2>Download Link:</h2>
        <a id="download_link" href="#" download="TOD_Decoded.txt">Download Processed File</a>
        <h2>Processed Content:</h2>
        <pre id="processed_content"></pre>
        <h2>Preview:</h2>
        <div id="preview"></div>
    </div>

    <script>
        function removeQuotes(line) {
            line = line.trim().replace(/^"|"$/g, '');
            return line.replace(/",$/, '');
        }

        function combineLines(lines) {
            return lines.join('');
        }

        function removeWhitespace(line) {
            return line.replace(/\s+/g, '');
        }

        function processJsonContent(content) {
            let lines = content.split('\n').map(removeQuotes);
            let combinedString = combineLines(lines);
            lines = combinedString.split('\n').map(removeWhitespace);
            return combineLines(lines);
        }

        function saveFileFromBase64(content) {
            let [metadata, base64Data] = content.split(';base64,');
            let fileExtension = 'txt'; // Default to txt for simplicity

            if (metadata.includes('image/png')) fileExtension = 'png';
            else if (metadata.includes('image/jpeg')) fileExtension = 'jpg';
            else if (metadata.includes('image/gif')) fileExtension = 'gif';
            else if (metadata.includes('image/svg+xml')) fileExtension = 'svg';
            else if (metadata.includes('text/html')) fileExtension = 'html';

            let decodedContent = atob(base64Data);
            return {decodedContent, fileExtension, base64Data, metadata};
        }

        function processJson(event) {
            event.preventDefault();
            let jsonContent = document.getElementById('json_content').value;
            let processedContent = processJsonContent(jsonContent);

            let processedElement = document.getElementById('processed_content');
            processedElement.textContent = processedContent;

            let {decodedContent, fileExtension, base64Data, metadata} = saveFileFromBase64(processedContent);
            let blob = new Blob([decodedContent], {type: 'application/octet-stream'});
            let downloadUrl = URL.createObjectURL(blob);

            let downloadLink = document.getElementById('download_link');
            downloadLink.href = downloadUrl;
            downloadLink.download = `TOD_Decoded.${fileExtension}`;

            let previewElement = document.getElementById('preview');
            previewElement.innerHTML = ''; // Clear previous preview
            if (metadata.includes('image/')) {
                let img = document.createElement('img');
                img.src = `data:${metadata};base64,${base64Data}`;
                img.style.maxWidth = '100%';
                previewElement.appendChild(img);
            } else if (metadata.includes('text/html')) {
                let iframe = document.createElement('iframe');
                iframe.srcdoc = decodedContent;
                iframe.style.width = '100%';
                iframe.style.height = '300px';
                previewElement.appendChild(iframe);
            } else {
                let pre = document.createElement('pre');
                pre.textContent = decodedContent;
                previewElement.appendChild(pre);
            }
        }
    </script>
</body>
</html>
