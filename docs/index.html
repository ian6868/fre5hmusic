<!DOCTYPE html>
<html>
<head>
  <style>
    body {
      background: black;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }
    canvas {
      background: black;
    }
  </style>
</head>
<body>
  <canvas id="pixelCanvas"></canvas>
  <script>
    function getRandomInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1) + min);
    }

    const canvas = document.getElementById("pixelCanvas");
    const ctx = canvas.getContext("2d");
    canvas.width = 480; // Adjust the width as desired
    canvas.height = 560; // Adjust the height as desired (280*2 to make the image twice as big)
    canvas.style.width = "90vw";
    canvas.style.height = "90vh";

    const colors = [
      ['#FA239B', '#DFC26B', '#C0A8C5'],
      ['#68EB2A', '#291893', '#7478BC'],
      ['#D61D07', '#ddfe43', '#9A4EC0']
    ];

    // Flatten and choose random colors
    const chosenColors = colors.flat().sort(() => 0.5 - Math.random()).slice(0, colors.length);
    const colorMap = chosenColors.reduce((map, color, index) => {
      map[index + 5] = color;
      return map;
    }, {9: 'transparent'});

    // Add color 10 to randomly pick from chosenColors
    colorMap[10] = chosenColors[Math.floor(Math.random() * chosenColors.length)];

    const numSpaces = 4; // Variable for the number of spaces at each end
    const numRows = 63; // Variable for the number of rows

    // Constants for canvas dimensions
    const canvasWidth = 480; // Adjust the width as desired
    const maxCanvasHeight = 560; // Adjust the max height as desired
    canvas.width = canvasWidth;
    canvas.height = maxCanvasHeight;

    // Calculate the pixel size to fit the pattern within the canvas height
    const pixelSize = 8; // Adjusted to fit within the canvas height
    const rowLength = canvasWidth / pixelSize;

    // Centering the canvas content
    ctx.scale(1, 1);

    const rugPattern = generateRugPattern(numSpaces, numRows, rowLength);

    function generateRugPattern(numSpaces, numRows, rowLength) {
      const halfPattern = [];

      for (let row = 0; row < Math.ceil(numRows / 2); row++) {
        const halfRowPattern = [];
        for (let col = 0; col < rowLength / 2; col++) {
          if (row === 0 || row === Math.ceil(numRows / 2) - 1) {
            halfRowPattern.push(10); // Solid color for top and bottom rows
          } else if (row % 2 === 0) {
            if (col < numSpaces) {
              halfRowPattern.push(10); // Solid color for the ends of even rows
            } else {
              halfRowPattern.push(getRandomInt(5, 5 + chosenColors.length - 1)); // Random pattern for the middle part of even rows
            }
          } else {
            if (col < numSpaces) {
              halfRowPattern.push(9); // Transparent for the ends of odd rows
            } else {
              halfRowPattern.push(getRandomInt(5, 5 + chosenColors.length - 1)); // Random pattern for the middle part of odd rows
            }
          }
        }
        const fullRowPattern = halfRowPattern.concat(halfRowPattern.slice().reverse());
        halfPattern.push(fullRowPattern);
      }

      // Add a half-sized row at the bottom for proper vertical mirroring
      const halfSizedRow = [];
      for (let col = 0; col < rowLength / 2; col++) {
        if (numSpaces > 0 && (col < numSpaces || col >= rowLength / 2 - numSpaces)) {
          halfSizedRow.push(9); // Transparent color for the ends of the half row
        } else {
          halfSizedRow.push(getRandomInt(5, 5 + chosenColors.length - 1)); // Random pattern for the middle part of the half row
        }
      }
      const fullHalfSizedRow = halfSizedRow.concat(halfSizedRow.slice().reverse());
      halfPattern.push(fullHalfSizedRow);

      const fullPattern = halfPattern.concat(halfPattern.slice(0, -1).reverse());

      return fullPattern.flat();
    }

    function getColorFromCode(code) {
      return colorMap[code];
    }

    function drawPixelArtRug() {
      for (let i = 0; i < rugPattern.length; i++) {
        const x = (i % rowLength) * pixelSize;
        const y = Math.floor(i / rowLength) * pixelSize;

        const color = getColorFromCode(rugPattern[i]);

        ctx.fillStyle = color;
        ctx.fillRect(x, y, pixelSize, pixelSize);
      }
    }

    drawPixelArtRug();

    document.querySelector("canvas").addEventListener("click", function () {
      location.reload();
    });
  </script>
</body>
</html>
